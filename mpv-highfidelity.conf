################################################################################
# MPV Configuration - Optimized for 2K Non-HDR Display with SVP
# Target: 2560x1440 @ 60Hz
# Focus: Maximum Visual Fidelity + SVP Frame Interpolation
################################################################################

###############
# GENERAL
###############

# Save position on quit
save-position-on-quit=yes
watch-later-options-clr

# Keep player open after file ends
keep-open=yes

# Prioritize quality over speed
priority=high

# Window settings
keepaspect=yes
keepaspect-window=no
autofit-larger=95%x95%
cursor-autohide=1000

# OSD settings
osd-level=1
osd-duration=2500
osd-font='Segoe UI'
osd-font-size=32
osd-border-size=2
osd-bar-h=2
osd-bar-w=60

###############
# VIDEO OUTPUT
###############

# Use GPU acceleration with D3D11 (best compatibility) or Vulkan (best quality)
# Uncomment ONE of these:
vo=gpu-next                    # New GPU renderer with best quality
#vo=gpu                        # Traditional GPU renderer (fallback)

# Graphics API - D3D11 recommended for Windows, Vulkan for best quality
gpu-api=d3d11                  # Most compatible, works with SVP
#gpu-api=vulkan                # Best quality, may need SVP adjustment

# GPU context
gpu-context=d3d11              # For D3D11
#gpu-context=winvk             # For Vulkan

# Hardware decoding (essential for high-res content + SVP)
hwdec=d3d11va                  # D3D11 Video Acceleration
hwdec-codecs=all               # Enable for all codecs

# Fallback to software decoding if HW fails
hwdec-extra-frames=24

###############
# SCALING & QUALITY
###############

# High-quality scaling algorithms
# For upscaling (when video < screen resolution)
scale=ewa_lanczos              # High-quality upscaling with anti-ringing
#scale=ewa_lanczossharp        # Sharper alternative
scale-antiring=0.7             # Reduce ringing artifacts

# For downscaling (when video > screen resolution)
dscale=mitchell                # High-quality downscaling
dscale-antiring=0.7

# Chroma upscaling
cscale=ewa_lanczossoft         # Smooth chroma upscaling
cscale-antiring=0.7

# Temporal interpolation (can work with SVP, but disable if conflicts)
#interpolation=yes             # Enable motion interpolation
#tscale=oversample             # Temporal scaling algorithm
# Note: Disable interpolation if using SVP, let SVP handle it

# Video sync mode - essential for smooth playback
video-sync=display-resample    # Resample audio to match display refresh rate
audio-pitch-correction=yes     # Maintain audio pitch when resampling

# Display resync settings
display-resample-max-change=10
display-resample-max-drift=0.05

###############
# DEINTERLACING
###############

# Auto-deinterlace
deinterlace=auto

###############
# DEBANDING
###############

# Enable debanding for better quality on compressed sources
deband=yes
deband-iterations=4            # Number of debanding passes (1-16)
deband-threshold=48            # Strength (0-4096)
deband-range=16                # Range in pixels (1-64)
deband-grain=48                # Add grain to hide banding (0-4096)

###############
# COLOR & TONE MAPPING
###############

# Color management (accurate colors)
icc-profile-auto=yes           # Auto-detect display ICC profile
target-colorspace-hint=yes
target-prim=bt.709             # Standard HD color primaries for SDR
target-trc=bt.1886             # Standard gamma curve for SDR displays

# Gamut mapping
gamut-mapping-mode=clip        # For SDR content

###############
# HDR TO SDR (for HDR content on SDR display)
###############

# Tone mapping for HDR content
tone-mapping=bt.2390           # BT.2390 (EETF) - most accurate
tone-mapping-mode=hybrid       # Hybrid tone mapping
tone-mapping-max-boost=1.0     # No boost for SDR display
hdr-compute-peak=yes           # Auto-detect peak luminance

# Target luminance for SDR display
target-peak=203                # Typical SDR display (~203 nits)

###############
# DITHERING
###############

# Dither to reduce color banding on 8-bit displays
dither-depth=auto
dither=fruit                   # High-quality dithering algorithm
#dither=ordered                # Alternative (faster)

###############
# SUBTITLES
###############

# Subtitle rendering
sub-auto=fuzzy                 # Auto-load subtitles
sub-file-paths=sub:subtitles:subs:Subs:Subtitles:SUB:SUBTITLES
blend-subtitles=yes            # Blend subtitles with video (better quality)

# Subtitle style
sub-font='Segoe UI'
sub-font-size=44
sub-color='#FFFFFFFF'
sub-border-color='#FF000000'
sub-border-size=2.4
sub-shadow-offset=1
sub-shadow-color='#33000000'
sub-bold=no
sub-spacing=0.5

# Subtitle positioning
sub-margin-y=36
sub-align-y=bottom

# ASS subtitle overrides
sub-ass-override=force         # Force custom style on ASS subs
sub-ass-force-margins=yes
sub-ass-force-style=Kerning=yes

###############
# AUDIO
###############

# Audio output
ao=wasapi                      # Windows Audio Session API (best for Windows)
audio-exclusive=no             # Don't use exclusive mode (for compatibility)

# Audio quality
audio-channels=stereo          # Stereo output (change to 5.1 if needed)
audio-normalize-downmix=yes
volume=100
volume-max=150

# Audio filtering
af=dynaudnorm=f=150:g=15       # Dynamic audio normalization

# Audio synchronization
audio-stream-silence=yes
audio-wait-open=2

###############
# CACHE & BUFFERING
###############

# Cache settings for smooth playback
cache=yes
cache-on-disk=yes              # Use disk for large cache
cache-dir='~~/cache'
demuxer-max-bytes=1024M        # 1GB forward buffer
demuxer-max-back-bytes=512M    # 512MB backward buffer
demuxer-readahead-secs=300     # 5 minutes readahead

###############
# SCREENSHOTS
###############

# High-quality screenshots
screenshot-format=png          # PNG for lossless quality
screenshot-png-compression=9   # Maximum compression
screenshot-high-bit-depth=yes  # Preserve bit depth
screenshot-template='mpv-screenshot-%F-%P'
screenshot-directory='~/Pictures/mpv-screenshots'

###############
# PERFORMANCE
###############

# Video decoder threads
vd-lavc-threads=8              # Adjust based on CPU cores

# Display refresh rate (adjust to your monitor)
override-display-fps=60        # Force 60Hz for consistency

###############
# SVP INTEGRATION
###############

# SVP requires vapoursynth or avisynth
# Make sure mpv is built with --enable-vapoursynth

# SVP video filter (uncomment if using SVP)
# Note: You need to have SVP installed and running
#input-ipc-server=/tmp/mpvsocket  # For SVP communication
#hr-seek-framedrop=no              # Accurate seeking for SVP
#resume-playback-check-mtime=no    # Don't check mtime for resume

# Additional settings for SVP compatibility
#video-sync=audio                   # Alternative sync mode for SVP
#no-resume-playback                 # Disable resume (optional)

###############
# PROFILES
###############

# Profile for 4K content (downscaling to 2K)
[4k-downscale]
profile-desc="4K content downscaling profile"
scale=ewa_lanczos
dscale=mitchell
linear-downscaling=no
correct-downscaling=yes
sigmoid-upscaling=yes

# Profile for 1080p content (upscaling to 2K)
[1080p-upscale]
profile-desc="1080p content upscaling profile"
scale=ewa_lanczossharp
scale-antiring=0.8
sigmoid-upscaling=yes
linear-upscaling=no

# Profile for low-quality sources
[low-quality]
profile-desc="Low-quality/compressed source enhancement"
deband=yes
deband-iterations=6
deband-threshold=64
deband-range=20
deband-grain=64

# Profile for anime content
[anime]
profile-desc="Optimized for anime"
scale=ewa_lanczossharp
cscale=ewa_lanczossoft
deband=yes
deband-iterations=3
deband-threshold=40
deband-range=12
deband-grain=24

# Auto profiles based on resolution
[auto-4k]
profile-cond=width >= 3840
profile=4k-downscale

[auto-1080p]
profile-cond=width >= 1920 and width < 2560
profile=1080p-upscale

[auto-720p]
profile-cond=width < 1920
profile=1080p-upscale

###############
# PROTOCOL-SPECIFIC
###############

# YouTube/Streaming optimizations
[protocol.https]
cache=yes
cache-secs=120
demuxer-max-bytes=512M

[protocol.http]
cache=yes
cache-secs=120
demuxer-max-bytes=512M

###############
# FILE-TYPE PROFILES
###############

# High bit-rate sources (Blu-ray remux, etc.)
[high-bitrate]
profile-desc="High bitrate video (>30 Mbps)"
profile-cond=estimated_vf_fps >= 30000000
hwdec=d3d11va-copy
deband=no

###############
# EXTENSIONS
###############

[extension.gif]
loop-file=inf

[extension.webm]
loop-file=inf

###############
# LANGUAGE PRIORITY
###############

# Preferred languages
alang=eng,en,jpn,ja
slang=eng,en

###############
# EXPERIMENTAL
###############

# GPU shader cache (faster startup)
gpu-shader-cache-dir='~~/shader-cache'

# Framebuffer format
fbo-format=rgba16f             # High precision framebuffer

# Advanced GPU settings
#opengl-pbo=yes                # Pixel Buffer Objects (if using OpenGL)

###############
# LOGGING (for troubleshooting)
###############

# Uncomment to enable detailed logging
#log-file='~~/mpv.log'
#msg-level=all=v

################################################################################
# IMPORTANT NOTES FOR SVP USERS
################################################################################
#
# 1. SVP Manager must be running before starting mpv
# 2. If using SVP, disable mpv's interpolation (comment out interpolation=yes)
# 3. SVP works best with:
#    - hwdec=d3d11va or hwdec=no (for processing)
#    - gpu-api=d3d11 (best compatibility)
#    - video-sync=display-resample
#
# 4. For SVP to work, you may need to add:
#    input-ipc-server=mpvpipe
#    to enable SVP communication
#
# 5. Recommended SVP settings:
#    - Motion vectors: 24 (quality)
#    - Artifact masking: Medium to Strong
#    - Frame interpolation: To screen refresh rate
#
################################################################################

################################################################################
# QUICK START GUIDE
################################################################################
#
# 1. Place this file as: <mpv-folder>/portable_config/mpv.conf
# 2. Install SVP from: https://www.svp-team.com/
# 3. Start SVP Manager
# 4. Open a video with mpv
# 5. Press 'o' to show stats overlay
# 6. Press 'i' to show file information
# 7. Press 's' to take a screenshot
#
# Key Bindings:
# - Space: Pause/Play
# - Left/Right: Seek 5 seconds
# - Up/Down: Seek 60 seconds
# - [/]: Adjust playback speed
# - m: Mute
# - 9/0: Adjust volume
# - f: Fullscreen
# - d: Toggle deinterlacing
# - `~ : Toggle statistics
#
################################################################################
