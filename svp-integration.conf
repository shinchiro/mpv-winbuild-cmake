################################################################################
# MPV Configuration - SVP-Specific Settings
#
# This file contains additional settings specifically optimized for SVP.
# Include this in your main mpv.conf or use as a separate profile.
#
# Usage:
#   1. Copy to portable_config/svp-integration.conf
#   2. Add to mpv.conf: include="~~/svp-integration.conf"
#   OR
#   3. Launch with: mpv --include="~~/svp-integration.conf" video.mkv
################################################################################

###############
# SVP CORE SETTINGS
###############

# IPC server for SVP communication (required for SVP integration)
# Windows named pipe
input-ipc-server=mpvpipe

# Alternative for older SVP versions:
#input-ipc-server=/tmp/mpvsocket

# Disable MPV's built-in interpolation (let SVP handle frame interpolation)
interpolation=no

# Video synchronization mode
# Option 1: display-resample (recommended for most cases)
video-sync=display-resample

# Option 2: audio (alternative if display-resample causes issues)
#video-sync=audio

# Audio pitch correction (prevents audio slowdown/speedup)
audio-pitch-correction=yes

###############
# HARDWARE DECODING FOR SVP
###############

# SVP requires access to decoded frames for processing
# d3d11va works well with SVP
hwdec=d3d11va

# Alternative options if d3d11va doesn't work:
#hwdec=d3d11va-copy    # Copy frames to system memory (slower but more compatible)
#hwdec=auto-copy       # Auto-select with copy
#hwdec=no              # Software decoding (highest compatibility, highest CPU usage)

# Decoder options
hwdec-codecs=all
hwdec-extra-frames=24

###############
# DISPLAY & REFRESH RATE
###############

# Force display refresh rate (set to your monitor's refresh rate)
override-display-fps=60

# For 75Hz displays:
#override-display-fps=75

# For 120Hz displays:
#override-display-fps=120

# For 144Hz displays:
#override-display-fps=144

# For variable refresh rate (G-Sync/FreeSync):
#override-display-fps=0

###############
# SEEKING & PLAYBACK
###############

# Accurate seeking (important for SVP)
hr-seek=yes
hr-seek-framedrop=no

# Resume playback settings
resume-playback=yes
resume-playback-check-mtime=no
save-position-on-quit=yes

###############
# CACHE SETTINGS FOR SVP
###############

# Larger cache for smooth SVP operation
cache=yes
demuxer-max-bytes=512M
demuxer-readahead-secs=120

# Backward seek cache
demuxer-max-back-bytes=256M

###############
# VIDEO OUTPUT FOR SVP
###############

# GPU renderer
vo=gpu-next

# Graphics API (D3D11 is most compatible with SVP)
gpu-api=d3d11
gpu-context=d3d11

# Alternative for Vulkan (experimental with SVP):
#gpu-api=vulkan
#gpu-context=winvk

###############
# FRAME TIMING
###############

# Display timing mode
display-timing=no

# Video latency
video-latency-hacks=yes

###############
# QUALITY SETTINGS (Compatible with SVP)
###############

# Scaling - use lighter algorithms with SVP for better performance
scale=bilinear              # Fast upscaling
dscale=bilinear             # Fast downscaling
cscale=bilinear             # Fast chroma scaling

# For better quality with powerful GPU:
#scale=spline36
#dscale=mitchell
#cscale=spline36

# Debanding (light settings to avoid performance issues)
deband=yes
deband-iterations=2
deband-threshold=48
deband-range=12
deband-grain=24

# Dithering
dither-depth=auto
dither=fruit

###############
# SUBTITLE RENDERING WITH SVP
###############

# Blend subtitles with video (required for SVP to see them)
blend-subtitles=yes

# Alternative (no blend, may cause subtitle issues with SVP):
#blend-subtitles=no

###############
# AUDIO OUTPUT
###############

# WASAPI audio output
ao=wasapi

# Audio buffer (larger for smoother playback)
audio-buffer=1.0

# Exclusive mode (disable for compatibility)
audio-exclusive=no

###############
# SVP-SPECIFIC VAPOURSYNTH INTEGRATION
###############

# If using VapourSynth script for SVP (advanced users)
# Uncomment and adjust path to your SVP VapourSynth script

#vf=vapoursynth="~~/svp.vpy"

# Example svp.vpy content:
# import vapoursynth as vs
# core = vs.get_core()
# clip = video_in
# clip = core.svp1.Super(clip)
# clip = core.svp2.Analyse(clip)
# clip = core.svp2.SmoothFps(clip)
# clip.set_output()

###############
# PROFILES FOR DIFFERENT SVP MODES
###############

# Profile: SVP Performance Mode
[svp-performance]
profile-desc="SVP with performance priority"
scale=bilinear
dscale=bilinear
cscale=bilinear
deband=no
hwdec=d3d11va

# Profile: SVP Quality Mode
[svp-quality]
profile-desc="SVP with quality priority"
scale=spline36
dscale=mitchell
cscale=spline36
deband=yes
deband-iterations=3
hwdec=d3d11va-copy

# Profile: SVP Software Decode (maximum compatibility)
[svp-software]
profile-desc="SVP with software decoding"
hwdec=no
scale=bilinear
dscale=bilinear
cscale=bilinear
deband=no

# Profile: SVP 120Hz Display
[svp-120hz]
profile-desc="SVP for 120Hz displays"
override-display-fps=120
video-sync=display-resample

# Profile: SVP 144Hz Display
[svp-144hz]
profile-desc="SVP for 144Hz displays"
override-display-fps=144
video-sync=display-resample

###############
# AUTO-LOAD PROFILES BY EXTENSION
###############

# Anime content with SVP
[extension.mkv]
profile-cond=string.match(filename, "anime") ~= nil
# Apply anime-specific settings here

# High frame rate content (disable SVP)
[extension.60fps]
profile-cond=container_fps >= 60
# Optionally disable SVP for native 60fps content
# SVP should automatically detect and skip processing

###############
# CONDITIONAL PROFILES FOR SVP
###############

# 4K content (may need performance adjustments)
[svp-4k]
profile-cond=width >= 3840
profile-desc="SVP 4K content adjustments"
scale=bilinear
deband-iterations=1
# Consider reducing SVP quality for 4K

# 1080p content (optimal for SVP)
[svp-1080p]
profile-cond=width >= 1920 and width < 3840
profile-desc="SVP 1080p optimization"
scale=spline36
deband-iterations=2

# 720p and below (can use higher quality)
[svp-720p]
profile-cond=width < 1920
profile-desc="SVP 720p+ upscaling"
scale=ewa_lanczos
deband-iterations=3

###############
# LOGGING FOR SVP TROUBLESHOOTING
###############

# Enable if having issues with SVP
#log-file=~~/svp-mpv.log
#msg-level=all=debug

################################################################################
# SVP CONFIGURATION CHECKLIST
################################################################################
#
# ✓ SVP Manager is running
# ✓ input-ipc-server is set (mpvpipe)
# ✓ interpolation=no (disabled)
# ✓ video-sync=display-resample
# ✓ hwdec=d3d11va (or appropriate method)
# ✓ override-display-fps matches your monitor
# ✓ blend-subtitles=yes
#
################################################################################

################################################################################
# SVP USAGE TIPS
################################################################################
#
# 1. FIRST RUN:
#    - Start SVP Manager
#    - Launch MPV with a video
#    - SVP should auto-detect MPV and start processing
#    - Check SVP icon in system tray - should show active
#
# 2. CHECKING SVP IS WORKING:
#    - Press ` (tilde) in MPV to see stats
#    - Look for "Display FPS" - should show interpolated rate (60fps+)
#    - SVP Manager should show "Active" status
#    - GPU usage should increase when playing video
#
# 3. SVP NOT WORKING?
#    - Restart SVP Manager
#    - Check SVP logs: SVP Manager → Application Settings → Logs
#    - Try hwdec=no (software decoding)
#    - Verify video codec is supported (H.264, HEVC work best)
#    - Update GPU drivers
#
# 4. PERFORMANCE ISSUES WITH SVP:
#    - Reduce SVP quality: Motion vectors → 12 or 16
#    - Use Performance profile: --profile=svp-performance
#    - Reduce video resolution if possible
#    - Close background applications
#    - Consider GPU upgrade for 4K content
#
# 5. KEYBINDINGS FOR SVP:
#    Add to input.conf:
#
#    Ctrl+s  apply-profile svp-performance    # Switch to performance mode
#    Ctrl+q  apply-profile svp-quality        # Switch to quality mode
#    Alt+s   cycle-values hwdec "d3d11va" "no"  # Toggle HW decode
#
# 6. SVP SETTINGS RECOMMENDATIONS:
#    For 2K display @ 60Hz:
#    - Frame interpolation: To screen refresh rate
#    - Motion vectors precision: 16-24 (balanced to quality)
#    - Artifact masking: Medium to Strong
#    - Motion vectors grid: 28px or 32px
#    - Decrease grid step: By 1 or By 2
#
# 7. ADVANCED: CUSTOM SVP PROFILES
#    In SVP Manager → Application Settings → Add profiles for:
#    - Anime (higher artifact masking)
#    - Sports (lower motion vectors, faster)
#    - Movies (highest quality settings)
#
################################################################################

################################################################################
# TROUBLESHOOTING COMMON SVP ISSUES
################################################################################
#
# ISSUE: "SVP not detected" or "SVP not starting"
# FIX:
#   1. Verify input-ipc-server=mpvpipe is set
#   2. Restart SVP Manager
#   3. Check Windows Firewall (allow SVP and MPV)
#   4. Reinstall SVP (repair installation)
#
# ISSUE: "Stuttering with SVP"
# FIX:
#   1. Lower SVP quality (motion vectors → 12)
#   2. Use hwdec=d3d11va
#   3. Increase cache: demuxer-max-bytes=1024M
#   4. Close other applications
#   5. Check GPU temperature (may be throttling)
#
# ISSUE: "Artifacts or blocking with SVP"
# FIX:
#   1. Increase artifact masking in SVP (Medium → Strong)
#   2. Use hwdec=d3d11va-copy or hwdec=no
#   3. Enable deband in MPV
#   4. Reduce motion vector precision (24 → 16)
#
# ISSUE: "Audio desync with SVP"
# FIX:
#   1. Ensure audio-pitch-correction=yes
#   2. Try video-sync=audio
#   3. Increase audio-buffer=1.5
#   4. Manual adjustment: Press z/Z keys
#
# ISSUE: "High GPU usage / overheating"
# FIX:
#   1. Reduce SVP quality
#   2. Lower resolution content
#   3. Use Performance profile
#   4. Improve GPU cooling
#   5. Cap frame rate if display is 60Hz
#
# ISSUE: "Subtitles not interpolated / flickering"
# FIX:
#   1. Ensure blend-subtitles=yes
#   2. Use ASS/SSA subtitles (better support)
#   3. Adjust SVP subtitle rendering settings
#
################################################################################
